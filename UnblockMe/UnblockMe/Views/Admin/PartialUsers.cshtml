@model List<Users>


@foreach (var user in Model)
{

    var userName = user.UserName.Substring(0, user.UserName.IndexOf("@"));
    <button type="button" class="btn btn-primary" id="user-@(userName)" data-toggle="modal" data-target="#editUser">
        <span class="buttonUserName">@userName</span>
        <span class="userId" hidden>@user.Id</span>
    </button>
}


<div class="modal fade" id="editUser" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="editUserForm">

                    <p hidden>
                        <input type="text" id="Id" required />
                    </p>
                    <p>
                        <label for="fName">First Name: </label>
                        <input type="text" id="fName" required />
                    </p>
                    <p>
                        <label for="lName">Last Name: </label>
                        <input type="text" id="lName" required />
                    </p>
                    <p>

                        <label for="email">Email: </label>
                        <input type="text" id="email" required />
                    </p>
                    <p>

                        <label for="phone">Phone: </label>
                        <input type="text" id="phone" required />
                    </p>

                </form>
                <button class="btn btn-primary" id="banAction" >Ban</button>
                <button class="btn btn-secondary" id="unbanAction">UnBan</button>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="submit" form="editUserForm" class="btn btn-primary">Save changes</button>
            </div>
        </div>
    </div>
</div>


<script>

    document.querySelector("#banAction").addEventListener('click', () => {
        let user_id = $("#Id").val();
        $.ajax({
            url: "BanUser",
            data: {
                id: user_id
            },
            success: function (status) {
             
            },
            error: function (error) {

                console.log(error.responseText);
            }

        });
    });

    $('button[id^="user"]').click(function () {

        $("#exampleModalLabel").text("User - " + $(this).children(".buttonUserName").text());
        var user_id = $(this).children(".userId").text();

        $.ajax({
            url: "GetUser",
            data: {
                id: user_id
            },
            success: function (data) {
                $("#Id").val(data.id);
                $("#fName").val(data.firstName);
                $("#lName").val(data.lastName);
                $("#email").val(data.email);
                $("#phone").val(data.phoneNumber);
            },
            error: function (error) {

                console.log(error.responseText);
            }

        });
    });
    $("#editUserForm").submit(function func(event) {

        event.preventDefault();

        var model = {
            Id: $("#Id").val(),
            FirstName: $("#fName").val(),
            LastName: $("#lName").val(),
            Email: $("#email").val(),
            PhoneNumber: $("#phone").val()

        };

        $.ajax({
            type: "POST",
            url: "updateUser",
            data: model,
            success: function (status) {

                location.reload();


            },
            error: function (error) {

                toastNotifyError(error.responseText, 1000);
            }
        })



    });
</script>