@using Microsoft.AspNetCore.Identity
@using UnblockMe.Services
@inject SignInManager<Users> SignInManager
@inject UserManager<Users> UserManager
@inject IUserService _userService
@inject ICarsService _carsService
@using System.Web;
@model List<Cars>

<link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
<script src="~/lib/jquery/dist/jquery.js"></script>
<script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.js"></script>
<script src="~/lib/jquery-validation/dist/additional-methods.js"></script>
<script src="~/lib/jquery-validation/dist/jquery.validate.js"></script>


<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#AddCar">
    Add Car
</button>

<div class="modal fade" id="AddCar" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Add a car</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="addCarForm">
                    <p>
                        <label for="addlicensePlate">License Plate: </label>
                        <input type="text" id="addlicensePlate" required />
                    </p>
                    <p>

                        <label for="addBrand">Brand: </label>
                        <input type="text" id="addBrand" required />
                    </p>
                    <p>

                        <label for="addColor">Color: </label>
                        <input type="text" id="addColor" required />
                    </p>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary">Add Car</button>
                    </div>

                </form>
                   
            </div>

        </div>
    </div>
</div>

<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#EditCar" id="editButton">
    Edit Car
</button>


<div class="modal fade" id="EditCar" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Edit a car!</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                @if(Model.Count()>0)
                {
                    <form id="editCarForm" method="post">
                        <select id="selectEditCar">

                            @{ int i = 1;}
                            @foreach (var element in Model)
                            {

                                <option value="@element.LicensePlate" id="select@(i)">@element.LicensePlate</option>
                                i++;
                            }
                        </select>
                        <br /><br />
                        <label for="brand">Brand</label>
                        <input type="text" id="brand" name="brand" />
                        <br />
                        <label for="color">Color</label>
                        <input type="text" id="color" name="color" />
                        <br />
                        <button type="button" class="btn btn-secondary" id="deletButton">Remove</button>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                            <button type="submit" class="btn btn-primary">Save changes</button>
                        </div>
                    </form>
                }
                else
                {
                    <p>You must add a car first!</p>
                }

            </div>
            
        </div>
    </div>
</div>


<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#ParkCar">
    Park Car
</button>

<div class="modal fade" id="ParkCar" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Park a car</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" id="modal-body">
                Park a car!
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary">Save changes</button>
            </div>
        </div>
    </div>
</div>
<script>
    $("#editCarForm").submit(function submitfunc(event) {
        event.preventDefault();
        $.ajax({
            url: "AddCar/EditCar",
            data: {
                licensePlate: $("#selectEditCar").val(),
                brand: $("#brand").val(),
                color: $("#color").val()

            },
            success: function (status) {
                
              

            },
            error: function (error) {
            
                
            }

        });
    });
    $("#selectEditCar").change(function EditCar(event) {
        
        $.ajax({
            url: "AddCar/GetCarByLicensePlate",
            data: {
                licensePlate: $(this).val()
            },
            success: function (data)
            {     
                $("#brand").val(data.brand);
                $("#licenseplate").val(data.licensePlate);
                $("#color").val(data.color);


            }

        });
    });
    $("#editButton").click(function func(event) {
        $.ajax({
            url: "AddCar/GetCarByLicensePlate",
            data: {
                licensePlate: $("#select1").val()
            },
            success: function (data) {

                $("#brand").val(data.brand);
                $("#licenseplate").val(data.licensePlate);
                $("#color").val(data.color);


            }
        })

    });
    $("#deletButton").click(function func(event) {
        $.ajax({
            url: "AddCar/RemoveCar",
            data: {
                licensePlate: $("#select1").val()
            },
            success: function (status) {

                window.location.reload();
                toastNotifySuccess(status, 1000);
               
            }
        })
    });
    $("#addCarForm").submit(function func(event) {
        event.preventDefault();
        var model = {
            LicensePlate : $("#addlicensePlate").val(),
            Brand : $("#addBrand").val(),
            Color : $("#addColor").val()
        };
   
        
        
        $.ajax({
            type: "POST",
            url: "AddCar/AddCar",
            data: model,
            success: function (status) {

                $("#AddCar").modal('hide');
                toastNotifySuccess(status, 1000);
            },
            error: function (error) {

                toastNotifyError(error.responseText, 1000);
            }
        })

    });
</script>