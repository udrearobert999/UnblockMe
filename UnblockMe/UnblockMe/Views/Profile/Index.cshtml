@model (Users,List<Cars>,Users,List<Cars>)
@using Microsoft.AspNetCore.Identity
@using UnblockMe.Services
@using AspNetCoreHero.ToastNotification.Abstractions;
@inject SignInManager<Users> SignInManager
@inject UserManager<Users> UserManager
@inject IUserService _userService
@inject ICarsService _carsService
@inject INotyfService _notyf


<script src="~/lib/jquery/dist/jquery.js"></script>
<link href="~/css/rating.css" rel="stylesheet" />


<p>@Model.Item3.FirstName - @Model.Item3.LastName</p>
<p>@Model.Item3.PhoneNumber</p>
<p>@Model.Item3.Email</p>
<img id="profilePicture" style="width:350px;height:350px; object-fit:cover"  src="/Profile/@Model.Item3.Id/Photo" />
<style>
    .rating:not(:hover) label input:checked ~ .icon,
    .rating:hover label:hover input ~ .icon {
        color: rgb(241,183,0) !important;
    }

    .rating label input:focus:not(:checked) ~ .icon:last-child {
        color: #000;
        text-shadow: 0 0 5px rgb(241,183,0);
    }
</style>
<form class="rating">
    <label>
        <input type="radio" name="stars" value="1" />
        <span class="icon">★</span>
    </label>
    <label>
        <input type="radio" name="stars" value="2" />
        <span class="icon">★</span>
        <span class="icon">★</span>
    </label>
    <label>
        <input type="radio" name="stars" value="3" />
        <span class="icon">★</span>
        <span class="icon">★</span>
        <span class="icon">★</span>
    </label>
    <label>
        <input type="radio" name="stars" value="4" />
        <span class="icon">★</span>
        <span class="icon">★</span>
        <span class="icon">★</span>
        <span class="icon">★</span>
    </label>
    <label>
        <input type="radio" name="stars" value="5" />
        <span class="icon">★</span>
        <span class="icon">★</span>
        <span class="icon">★</span>
        <span class="icon">★</span>
        <span class="icon">★</span>
    </label>
</form>



<div class="container">
    @if (SignInManager.IsSignedIn(User))
    {
       
        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#UnblockMe">
            Unblock me!
        </button>
        <div class="modal custom fade" id="UnblockMe" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Unblock Me!</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form method="post" id="form2">
                            <p>Contact Method:</p>
                            <label for="ContactSMS">SMS</label>
                            <input type="radio" name="Contact" value="SMS" id="Contact" checked />
                            <label for="ContactEmail">Email</label>
                            <input type="radio" name="Contact" value="Email" id="Contact" />
                            <br />
                            <label for="myplates">My Cars:</label>
                            <select name="myplates" id="myplates" required>
                                @foreach (var element in Model.Item2)
                                {
                                    <option value="@element.LicensePlate">@element.LicensePlate</option>
                                }


                            </select>
                            <label for="yourplates">@(Model.Item3.FirstName)'s Cars</label>
                            <select name="yourplates" id="yourplates" required>
                                @foreach (var element in Model.Item4)
                                {
                                    <option value="@element.LicensePlate">@element.LicensePlate</option>
                                }
                            </select>

                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                <button type="submit" class="btn btn-primary" id="button">Send</button>


                            </div>
                        </form>
                    </div>

                </div>
            </div>
        </div>

        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#BlockedYou">
            I have blocked you!
        </button>
        <div class="modal custom fade" id="BlockedYou" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">I have blocked you!</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">

                        <form method="post" id="form1">
                            <p>Contact Method:</p>
                            <label for="ContactSMS">SMS</label>
                            <input type="radio" name="Contact" value="SMS" id="Contact" checked />
                            <label for="ContactEmail">Email</label>
                            <input type="radio" name="Contact" value="Email" id="Contact" />
                            <br />
                            <label for="myplates">My Cars:</label>
                            <select name="myplates" id="myplates" required>
                                @foreach (var element in Model.Item2)
                                {
                                    <option value="@element.LicensePlate">@element.LicensePlate</option>
                                }


                            </select>
                            <label for="yourplates">@(Model.Item3.FirstName)'s Cars</label>
                            <select name="yourplates" id="yourplates" required>
                                @foreach (var element in Model.Item4)
                                {
                                    <option value="@element.LicensePlate">@element.LicensePlate</option>
                                }
                            </select>

                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                <button type="submit" class="btn btn-primary" id="button">Send</button>


                            </div>
                        </form>
                    </div>

                </div>
            </div>
        </div>

    }
</div>
<script>
    $("#form1").submit(function blockedyou(event) {
        event.preventDefault();
        $.ajax({
            url: "BlockedYouAction",
            data: {
                Contact: $("#Contact").val(),
                MyPlate: $("#myplates").val(),
                YourPlate: $("#yourplates").val()
            },
            success: function (status) {
                $("#BlockedYou").modal('hide');
                toastNotifySuccess(status, 1000);
                
            },
            error: function (error) {
              
                $("#BlockedYou").modal('hide');
                toastNotifyError(error.responseText, 1000);
            }

        });


    });
    $("#form2").submit(function unblockme(event) {
        event.preventDefault();
        $.ajax({
            url: "BlockedMeAction",
            data: {
                Contact: $("#Contact").val(),
                MyPlate: $("#myplates").val(),
                YourPlate: $("#yourplates").val()
            },
            success: function (status) {

                console.log(status);
                $("#UnblockMe").modal('hide');
                toastNotifySuccess(status, 1000);

            },
            error: function (error) {

                $("#UnblockMe").modal('hide');
                toastNotifyError(error.responseText, 1000);
            }
        });
        
   
    });

</script>
